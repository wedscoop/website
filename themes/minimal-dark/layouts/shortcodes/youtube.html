{{/* Load and parse JSON using modern Hugo method */}}
{{ $filmsFile := resources.Get "data/weddingfilms.json" }}
{{ if $filmsFile }}
  {{ $filmsData := $filmsFile | transform.Unmarshal }}
  {{ $films := index $filmsData "weddingfilms" }}

  {{ if $films }}
    <div 
      x-data="{ open: false, selectedId: null }"
      x-effect="open ? document.body.style.overflow = 'hidden' : document.body.style.overflow = ''"
      @keydown.window.escape="open = false; selectedId = null">

      <!-- Grid -->
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        {{ range $films }}
          {{ $film := . }}
          <div class="relative cursor-pointer rounded-lg overflow-hidden shadow-lg group">

            <!-- Thumbnail -->
            <div class="aspect-video w-full relative overflow-hidden rounded-lg">
              <img
                src="https://img.youtube.com/vi/{{ index $film "videoId" }}/hqdefault.jpg"
                alt="{{ index $film "title" }}"
                loading="lazy" decoding="async"
                class="absolute inset-0 w-full h-full object-cover object-center
                       transition-transform duration-[900ms] ease-[cubic-bezier(0.25,0.1,0.25,1)]
                       group-hover:scale-105 group-hover:brightness-110 rounded-lg">
              
              <!-- Play button -->
              <button
                @click="selectedId='{{ index $film "videoId" }}'; open = true"
                class="absolute inset-0 flex items-center justify-center text-white text-4xl
                       bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity duration-400"
                aria-label="Play {{ index $film "title" }}">
                ▶
              </button>
            </div>

            <!-- Title -->
            <h3 class="mt-2 text-lg font-semibold text-white text-center"
                style="font-family: 'Raleway', sans-serif;">
              {{ index $film "title" }}
            </h3>
          </div>
        {{ end }}
      </div>

      <!-- Fullscreen Modal -->
      <div
        x-show="open"
        x-cloak
        x-transition.opacity
        class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-80 p-4 sm:p-6"
        role="dialog"
        aria-modal="true">

        <!-- Close Button -->
        <button
          @click="open = false; selectedId = null"
          class="absolute top-4 right-4 text-white text-3xl font-bold z-50"
          aria-label="Close video">✕</button>

        <!-- Video Container -->
        <div class="w-full max-w-4xl aspect-video relative z-40 rounded-lg overflow-hidden shadow-xl">
          <template x-if="open && selectedId">
            <iframe
              :src="'https://www.youtube.com/embed/' + selectedId + '?autoplay=1&rel=0'"
              frameborder="0"
              allow="autoplay; encrypted-media; fullscreen"
              class="w-full h-full absolute top-0 left-0"
              allowfullscreen
            ></iframe>
          </template>
        </div>
      </div>
    </div>
  {{ else }}
    <p class="text-gray-400 text-center py-8">⚠️ No wedding films found inside JSON file.</p>
  {{ end }}
{{ else }}
  <p class="text-gray-400 text-center py-8">⚠️ Could not load assets/data/weddingfilms.json.</p>
{{ end }}

<style>
@keyframes fadeInUp {
  0% { opacity: 0; transform: translateY(10px); }
  100% { opacity: 1; transform: translateY(0); }
}
.group { opacity: 0; animation: fadeInUp 0.6s ease-out forwards; }
.group:nth-child(2n) { animation-delay: 0.06s; }
.group:nth-child(3n) { animation-delay: 0.12s; }

.group img {
  transition: transform 0.9s cubic-bezier(0.25, 0.1, 0.25, 1),
              filter 0.9s cubic-bezier(0.25, 0.1, 0.25, 1);
  will-change: transform, filter;
}
.group:hover img {
  transform: scale(1.05);
  filter: brightness(1.1);
}

.group button {
  transition: opacity 0.4s ease;
}

[x-cloak] { display: none !important; }
</style>
